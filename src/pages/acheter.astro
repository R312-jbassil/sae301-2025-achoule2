---
import Layout from '../layouts/Layout.astro'
import Header from '../components/Header.astro'
import Footer from '../components/Footer.astro'
---

<Layout>
  <Header />
  <main>
    <h2 class="text-2xl font-bold uppercase my-8 text-center">Finaliser la commande</h2>
    <div id="purchase-content"></div>
  </main>
  <Footer />
  
  <script>
    // Récupère l'index de la création dans l'URL
    const params = new URLSearchParams(window.location.search);
    const idx = params.get('idx');

    const creations = JSON.parse(localStorage.getItem('creations') || '[]');
    const selected = creations[idx];

    if (!selected) {
      document.getElementById('purchase-content').innerHTML = `<div class="text-center text-red-500">Aucune création sélectionnée</div>`;
    } else {
      document.getElementById('purchase-content').innerHTML = `
        <div class="flex flex-col md:flex-row gap-10 items-start justify-center max-w-4xl mx-auto">
          <div class="bg-black text-white rounded p-6 w-full max-w-xs">
            <div class="mb-2 flex items-center justify-center">${selected.svg}</div>
            <div class="text-xs uppercase text-gray-200 mb-1">Monture : ${selected.frameMaterial}</div>
            <div class="text-xs uppercase text-gray-200 mb-1">Branches : ${selected.templeMaterial}</div>
            <div class="text-xs uppercase text-gray-200 mb-1">Dimensions : ${selected.bridgeWidth}mm / ${selected.lensSize}mm</div>
            <div class="my-3 border-t border-white/10"></div>
            <div class="flex justify-between text-lg mb-2"><span>Lunettes Tavue</span><span>299 €</span></div>
            <div class="flex justify-between text-xs text-green-500"><span>Livraison</span><span>GRATUITE</span></div>
            <div class="flex justify-between font-bold text-xl pt-3 border-t border-white/10"><span>Total</span><span>299 €</span></div>
          </div>
          <!-- Pane paiement (factice ici) -->
          <form class="bg-black text-white rounded p-6 flex-1 max-w-xl" onsubmit="alert('Paiement simulé !'); return false;">
            <h3 class="mb-4 uppercase font-bold text-base">Informations de paiement</h3>
            <label class="block text-xs mb-1 mt-2">Numéro de carte</label>
            <input class="w-full mb-3 rounded bg-white/10 p-2 text-white" required pattern="\\d{16}">
            
            <label class="block text-xs mb-1">Nom du titulaire</label>
            <input class="w-full mb-3 rounded bg-white/10 p-2 text-white" required>
            
            <label class="block text-xs mb-1">Date d'expiration</label>
            <input class="w-full mb-3 rounded bg-white/10 p-2 text-white" placeholder="MM/AA" required pattern="\\d{2}/\\d{2}">
            
            <label class="block text-xs mb-1">CVV</label>
            <input class="w-full mb-3 rounded bg-white/10 p-2 text-white" required pattern="\\d{3}">
            
            <div class="text-xs text-gray-300 mb-3 mt-4">Vos informations bancaires sont cryptées et sécurisées. Nous n'enregistrons jamais vos données de carte.</div>
            <button type="submit" class="w-full py-3 rounded bg-red-600 font-bold text-lg hover:bg-red-700">PAYER 299&nbsp;€</button>
          </form>
        </div>
      `;
    }
  </script>
</Layout>
